name: ProductionAuthMigration

on:
  release:
    types: [published]

env:
  AUTH_MIGRATION_API: ${{ secrets.PRODUCTION_AUTH_MIGRATION_API }}
  AUTHORIZATION_TOKEN: ${{ secrets.PRODUCTION_DIRTY_HACK_TOKEN }}

jobs:
  adding-auth-data-in-identity-service:
    name: Adding Auth Data in Identity Service
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: curl
        uses: wei/curl@v1
        with:
          args: -X POST '${{ env.AUTH_MIGRATION_API }}' --header 'Authorization: ${{ env.AUTHORIZATION_TOKEN }}' --form 'json_file=@migrations.json'